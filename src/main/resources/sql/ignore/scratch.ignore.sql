USE local_pi;

select * from pis;
 
INSERT INTO pis (`PI_ID`, `AWS_IOT_THING_ID`, `CLIENT_ID`) VALUES ('pi-PQTMXIB', 'pi-PQTMXIB', 'client-pi-PQTMXIB');

INSERT INTO component_serials (`SERIAL_NUMBER`, `TYPE`) VALUES ("ABCDEFGH", "WEATHER");


INSERT INTO component_serials
(`SERIAL_NUMBER`, `TYPE`)
VALUES
("DOOR-01", "DOOR"),
("FOOD-01", "FOOD"),
("WATER-01", "WATER"),
("WEATHER-01", "WEATHER");

select * from users;

SELECT * from component_serials;

select * from components;

select * from metrics;


insert into metrics
(`dt`, `year`, `month`, `week`, `day`, `hour`, `coop_id`, `component_id`, `metric`, `value`)
values
('1704913951340', 2024, 202101, 202402, 20210110, 2024011001, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 15),
('1704913951341', 2024, 202101, 202402, 20210110, 2024011002, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 16),
('1704913951342', 2024, 202101, 202402, 20210110, 2024011003, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 17),
('1704913951343', 2024, 202101, 202402, 20210110, 2024011004, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 18),
('1704913951344', 2024, 202101, 202402, 20210110, 2024011005, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 19),
('1704913951345', 2024, 202101, 202402, 20210110, 2024011006, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 20),
('1704913951346', 2024, 202101, 202402, 20210110, 2024011007, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 19),
('1704913951347', 2024, 202101, 202402, 20210110, 2024011008, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 18),
('1704913951348', 2024, 202101, 202402, 20210110, 2024011009, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 17),
('1704913951349', 2024, 202101, 202402, 20210110, 2024011010, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 16),
('1704913951350', 2024, 202101, 202402, 20210110, 2024011011, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 15),
('1704913951351', 2024, 202101, 202402, 20210110, 2024011012, '4028b2698cd4e444018cd4e69eed0001', '4028b2698cd4e444018cd4f9a6130005', 'HUMIDITY', 14);



ALTER TABLE METRICS ADD COLUMN QUARTER_DAY INT;
ALTER TABLE METRICS ADD INDEX `quarter_day_index` (`COOP_ID`, `QUARTER_DAY`, `METRIC`);

UPDATE METRICS
SET QUARTER_DAY = FLOOR((`HOUR` / 4))
where dt > 0;

UPDATE METRICS
SET QUARTER_DAY = QUARTER_DAY * 4
where dt > 0;


SELECT * FROM METRICS;

SELECT 
	`YEAR`, 
    `MONTH`, 
    `WEEK`, 
    `DAY`, 
    `HOUR` / 4 AS `QUARTER_DAY`,
    `HOUR`, 
    `COMPONENT_ID`, 
    `METRIC`, 
    `VALUE`
FROM METRICS;


INSERT INTO component_serials
(`SERIAL_NUMBER`, `TYPE`)
VALUES
("01504A14", "SCALE");

INSERT INTO component_serials
(`SERIAL_NUMBER`, `TYPE`)
VALUES
("0150655B", "MOISTURE"),
("015042B7", "WEATHER");

SELECT *
FROM METRICS
ORDER BY DT DESC;

select * from users;

DELETE c
FROM COMPONENTS c
JOIN COMPONENT_SERIALS cs
  ON cs.SERIAL_NUMBER = c.SERIAL_NUMBER
WHERE cs.`TYPE` NOT IN ('SCALE', 'MOISTURE', 'WEATHER');
SET SQL_SAFE_UPDATES=0;
delete from component_serials where
`type` not in  ('SCALE', 'MOISTURE', 'WEATHER');


select *
from component_config;

delete from component_config
where component_id !='1';